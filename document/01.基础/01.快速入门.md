# 快速入门

`final-security 前提条件：java 8+ springboot 2.x以上`

## 依赖

> final-security 依赖于spring-web，将spring-web与final-security一并引入

```xml

<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>

<dependency>
<groupId>top.lingkang</groupId>
<artifactId>final-security-core</artifactId>
</dependency>
```

## 前言

`final-security`默认拦截所有请求，使用前需要先配置排除路径：

```yaml
final:
  security:
    exclude-path: /login,logout
```

或者代码中：

```aidl
@Configuration
public class FinalConfig {
    @Bean
    public FinalConfigProperties configProperties(){
        FinalConfigProperties properties=new FinalConfigProperties();
        properties.setExcludePath(new String[]{"/login","/logout"});
        return properties;
    }
}
```
> 通过上面的配置，我们可以访问登录和注销了。

## 1、登录
首先注入FinalHolder持有者进行操作
```java
@Autowired
private FinalHolder finalHolder;
```

登录 id通常指用户的id，你这里也可以用username来登录；在web中会生成对应的会话，通过cookie维持
```java
@Autowired
private FinalHolder finalHolder;

@GetMapping("login")
public Object login(){
    finalHolder.login("lk");
    // finalHolder.login("lk",true); //开启记住我功能
    return"index";
}
```

> 登录后即可访问其他资源

## 2、注销

注销当前用户id或指定用户id

```java
@Autowired
private FinalHolder finalHolder;

// 注销当前会话
finalHolder.logout();
// 注销指定id
// finalHolder.logout("lk");
```

## 3、添加角色权限
```java
    @GetMapping("login")
    public Object login() {
        finalHolder.login("lk");// 登陆
        finalHolder.addRoles("user", "admin", "system");// 添加角色
        finalHolder.addPermission("get", "update", "delete");// 添加权限
        return "ok";
    }
```
对路径进行鉴权
```java
    @Bean
    public FinalHttpSecurity httpSecurity(){
        FinalHttpSecurity security=new DefaultFinalHttpSecurity();
        HashMap<String, FinalAuth> map = new HashMap<>();
        map.put("/user", new FinalAuth().hasRoles("user"));// 必须拥有user角色
        map.put("/about", new FinalAuth().hasPermission("get"));// 必须拥有get权限
        map.put("/updatePassword", new FinalAuth().hasRoles("user").hasPermission("update"));// 需要拥有user角色和update权限
        map.put("/index", new FinalAuth().hasRoles("admin", "system").hasPermission("get"));// 至少有一个角色并拥有get权限
        map.put("/vip", new FinalAuth().hasAllRoles("user","vip"));// 需要同时拥有角色
        security.setCheckAuths(map);
        return security;
    }
```